(function(l,r,S,t,G,z,N,P,F){"use strict";const v=r.findByProps("canUseAnimatedEmojis"),$="canUseStickersEverywhere",A="canUseCustomStickersEverywhere",I=v[A]?A:$;function B(){return S.instead(I,v,function(){return!0})}const{getChannel:x}=r.findByStoreName("ChannelStore"),L="https://media.discordapp.net/stickers/{stickerId}.{format}?size={size}";function M(e,n){if(!e.guild_id)return!0;const a=x(n).guild_id;return e.guild_id==a}function U(e){const n=e.format_type===4?"gif":"png";return L.replace("{stickerId}",e.id).replace("{format}",n).replace("{size}",t.storage.stickerSize.toString())}async function O(e){try{let n=new FormData;n.append("new-image-url",e);let a=await fetch("https://ezgif.com/apng-to-gif",{method:"POST",body:n});const c=a.url.split("/").pop();return n=new FormData,n.append("file",c),n.append("size",t.storage.stickerSize.toString()),a=await fetch(`https://ezgif.com/apng-to-gif/${c}?ajax=true`,{method:"POST",body:n}),`https:${(await a.text()).split('<img src="')[1].split('" style=')[0]}`}catch(n){return z.logger.error(`Failed to convert ${e} to GIF: `,n),null}}const f=new Map;function V(e,n){f.set(e,n),setTimeout(function(){return f.delete(e)},18e5)}function _(e){return f.get(e)}const{openAlert:D}=r.findByProps("openAlert","dismissAlert"),{AlertModal:b,AlertActionButton:d}=r.findByProps("AlertModal","AlertActions"),{Stack:j,TextInput:ce}=r.findByProps("Stack");function w(e){b&&d?H(e):N.showConfirmationAlert(e)}function H({title:e,content:n,placeholder:a,confirmText:c,cancelText:m,onConfirm:p}){D(K(e),React.createElement(b,{title:e,content:n,actions:React.createElement(j,null,React.createElement(d,{text:c,variant:"primary",onPress:p}),m?React.createElement(d,{text:m,variant:"secondary"}):React.createElement(React.Fragment,null))}))}function K(e){return`vdarnfg-${e?.toLowerCase?.().replaceAll?.(" ","-")}`}function q(e){w({title:"APNG Sticker",content:`This sticker will be converted to a GIF using Ezgif and an Ezgif link will be sent in chat.
Do you want to continue?`,confirmText:"Continue",cancelText:"Cancel",onConfirm:e})}function J(e){w({title:"APNG conversion failed",content:[(e?"Instead of an animated GIF, raw APNG sticker will be sent in chat":"No stickers will be sent in chat")+", you can customize this behavior in plugin settings.","","Check debug logs for more information about the error."].join(`
`),confirmText:"OK"})}const R=r.findByProps("sendMessage","receiveMessage"),{getStickerById:Q}=r.findByStoreName("StickersStore"),{getCurrentUser:W}=r.findByStoreName("UserStore");function X(){return S.instead("sendStickers",R,function(e,n){if(!t.storage.ignoreNitro&&W?.().premiumType!==null)return n(...e);const[a,c,m,p]=e,h=c.map(function(i){return Q(i)}).filter(function(i){return!M(i,a)});if(!h.length)return n(...e);const C=async function(i){i&&(t.storage.ackedApng=!0);for(const u of h){let o=U(u);if(u.format_type===2&&t.storage.convertApng){let k=_(o);if(!k){G.showToast("Converting APNG sticker to GIF..");const y=await O(o);if(y)V(o,y);else if(J(t.storage.staticApngOnFail),!t.storage.staticApngOnFail)continue;k=y}o=k??o}t.storage.hyperlink&&u.name&&(o=`[${u.name}](${o})`),R.sendMessage(a,{content:o},null,p)}};h.find(function(i){return i.format_type==2})&&!t.storage.ackedApng?q(function(){return C(!0)}):C()})}const{Stack:Y,TableRadioGroup:Z,TableRadioRow:ee,TableSwitchRow:s,TableRowGroup:E}=r.findByProps("TableRow","TableRowGroup"),{ScrollView:te}=F.General,ne=r.findByName("HelpMessage"),re=[16,32,64,128,160,256,512,1024];t.storage.convertApng??=!0,t.storage.hyperlink??=!0,t.storage.stickerSize??=160;function ae(){return P.useProxy(t.storage),React.createElement(te,{style:{flex:1},contentContainerStyle:{paddingBottom:38}},React.createElement(Y,{style:{paddingVertical:24,paddingHorizontal:12},spacing:24},React.createElement(E,{title:"General"},React.createElement(s,{label:"Hyperlink stickers",value:t.storage.hyperlink,onValueChange:function(e){return t.storage.hyperlink=e}}),React.createElement(s,{label:"Ignore Nitro",subLabel:"Force FreeStickers even when you have Nitro",value:t.storage.ignoreNitro,onValueChange:function(e){return t.storage.ignoreNitro=e}})),React.createElement(E,{title:"APNG Stickers"},React.createElement(s,{label:"Convert APNG stickers to GIF",subLabel:"This is needed for stickers to be animated (uses Ezgif).",value:t.storage.convertApng,onValueChange:function(e){return t.storage.convertApng=e}}),React.createElement(s,{label:"Send static sticker if APNG conversion fails",value:t.storage.staticApngOnFail,onValueChange:function(e){return t.storage.staticApngOnFail=e}}),React.createElement(s,{label:"Show warning dialog for APNG stickers",subLabel:"This will only appear once",value:!t.storage.ackedApng,onValueChange:function(e){return t.storage.ackedApng=!e}})),React.createElement(Z,{title:"Stickers Size",value:t.storage.stickerSize.toString(),onChange:function(e){return t.storage.stickerSize=parseInt(e)}},re.map(function(e){return React.createElement(ee,{label:e.toString(),subLabel:e==160?"Default":null,key:e.toString(),value:e.toString()})})),React.createElement(ne,{messageType:0},"Stickers size option does not work consistently at the moment.")))}let g;const oe=function(){g&&T(),g=[B(),X()]},T=function(){return g?.forEach?.(function(e){return e?.()})},ie=ae;return l.onLoad=oe,l.onUnload=T,l.settings=ie,l})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.ui.toasts,vendetta,vendetta.ui.alerts,vendetta.storage,vendetta.ui.components);
