(function(u,r,y,t,G,z,N,P,F){"use strict";const S=r.findByProps("canUseAnimatedEmojis"),$="canUseStickersEverywhere",v="canUseCustomStickersEverywhere",I=S[v]?v:$;function B(){return y.instead(I,S,function(){return!0})}const{getChannel:x}=r.findByStoreName("ChannelStore"),L="https://media.discordapp.net/stickers/{stickerId}.{format}?size={size}";function M(e,n){if(!e.guild_id)return!0;const a=x(n).guild_id;return e.guild_id==a}function U(e){const n=e.format_type===4?"gif":"png";return L.replace("{stickerId}",e.id).replace("{format}",n).replace("{size}",t.storage.stickerSize.toString())}async function O(e){try{let n=new FormData;n.append("new-image-url",e);let a=await fetch("https://ezgif.com/apng-to-gif",{method:"POST",body:n});const s=a.url.split("/").pop();return n=new FormData,n.append("file",s),n.append("size",t.storage.stickerSize.toString()),a=await fetch(`https://ezgif.com/apng-to-gif/${s}?ajax=true`,{method:"POST",body:n}),`https:${(await a.text()).split('<img src="')[1].split('" style=')[0]}`}catch(n){return z.logger.error(`Failed to convert ${e} to GIF: `,n),null}}const g=new Map;function V(e,n){g.set(e,n),setTimeout(function(){return g.delete(e)},18e5)}function _(e){return g.get(e)}const{openAlert:D}=r.findByProps("openAlert","dismissAlert"),{AlertModal:A,AlertActionButton:m}=r.findByProps("AlertModal","AlertActions"),{Stack:j,TextInput:ce}=r.findByProps("Stack");function b(e){A&&m?H(e):N.showConfirmationAlert(e)}function H(e){let{title:n,content:a,placeholder:s,confirmText:C,cancelText:f,onConfirm:l}=e;D(K(n),React.createElement(A,{title:n,content:a,actions:React.createElement(j,null,React.createElement(m,{text:C,variant:"primary",onPress:l}),f?React.createElement(m,{text:f,variant:"secondary"}):React.createElement(React.Fragment,null))}))}function K(e){return`vdarnfg-${e?.toLowerCase?.().replaceAll?.(" ","-")}`}function q(e){b({title:"APNG Sticker",content:`This sticker will be converted to a GIF using Ezgif and an Ezgif link will be sent in chat.
Do you want to continue?`,confirmText:"Continue",cancelText:"Cancel",onConfirm:e})}function J(e){b({title:"APNG conversion failed",content:[(e?"Instead of an animated GIF, raw APNG sticker will be sent in chat":"No stickers will be sent in chat")+", you can customize this behavior in plugin settings.","","Check debug logs for more information about the error."].join(`
`),confirmText:"OK"})}const w=r.findByProps("sendMessage","receiveMessage"),{getStickerById:Q}=r.findByStoreName("StickersStore"),{getCurrentUser:W}=r.findByStoreName("UserStore");function X(){return y.instead("sendStickers",w,function(e,n){if(!t.storage.ignoreNitro&&W?.().premiumType!==null)return n(...e);const[a,s,C,f]=e,l=s.map(function(i){return Q(i)}).filter(function(i){return!M(i,a)});if(!l.length)return n(...e);const T=async function(i){i&&(t.storage.ackedApng=!0);for(const d of l){let o=U(d);if(d.format_type===2&&t.storage.convertApng){let h=_(o);if(!h){G.showToast("Converting APNG sticker to GIF..");const k=await O(o);if(k)V(o,k);else if(J(t.storage.staticApngOnFail),!t.storage.staticApngOnFail)continue;h=k}o=h??o}t.storage.hyperlink&&d.name&&(o=`[${d.name}](${o})`),w.sendMessage(a,{content:o},null,f)}};l.find(function(i){return i.format_type==2})&&!t.storage.ackedApng?q(function(){return T(!0)}):T()})}const{Stack:Y,TableRadioGroup:Z,TableRadioRow:ee,TableSwitchRow:c,TableRowGroup:R}=r.findByProps("TableRow","TableRowGroup"),{ScrollView:te}=F.General,ne=r.findByName("HelpMessage"),re=[16,32,64,128,160,256,512,1024];t.storage.convertApng??=!0,t.storage.hyperlink??=!0,t.storage.stickerSize??=160;function ae(){return P.useProxy(t.storage),React.createElement(te,{style:{flex:1},contentContainerStyle:{paddingBottom:38}},React.createElement(Y,{style:{paddingVertical:24,paddingHorizontal:12},spacing:24},React.createElement(R,{title:"General"},React.createElement(c,{label:"Hyperlink stickers",value:t.storage.hyperlink,onValueChange:function(e){return t.storage.hyperlink=e}}),React.createElement(c,{label:"Ignore Nitro",subLabel:"Force FreeStickers even when you have Nitro",value:t.storage.ignoreNitro,onValueChange:function(e){return t.storage.ignoreNitro=e}})),React.createElement(R,{title:"APNG Stickers"},React.createElement(c,{label:"Convert APNG stickers to GIF",subLabel:"This is needed for stickers to be animated (uses Ezgif).",value:t.storage.convertApng,onValueChange:function(e){return t.storage.convertApng=e}}),React.createElement(c,{label:"Send static sticker if APNG conversion fails",value:t.storage.staticApngOnFail,onValueChange:function(e){return t.storage.staticApngOnFail=e}}),React.createElement(c,{label:"Show warning dialog for APNG stickers",subLabel:"This will only appear once",value:!t.storage.ackedApng,onValueChange:function(e){return t.storage.ackedApng=!e}})),React.createElement(Z,{title:"Stickers Size",value:t.storage.stickerSize.toString(),onChange:function(e){return t.storage.stickerSize=parseInt(e)}},re.map(function(e){return React.createElement(ee,{label:e.toString(),subLabel:e==160?"Default":null,key:e.toString(),value:e.toString()})})),React.createElement(ne,{messageType:0},"Stickers size option does not work consistently at the moment.")))}let p;const oe=function(){p&&E(),p=[B(),X()]},E=function(){return p?.forEach?.(function(e){return e?.()})},ie=ae;return u.onLoad=oe,u.onUnload=E,u.settings=ie,u})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.ui.toasts,vendetta,vendetta.ui.alerts,vendetta.storage,vendetta.ui.components);
