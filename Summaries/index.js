(function(s,d,g,i,m,o,h,p,S){"use strict";const{Stack:f,TableRowGroup:y,TextInput:E}=i.findByProps("Stack","TableRowGroup"),{ScrollView:R}=S.General;o.storage.guildWhitelist??="";function $(){return p.useProxy(o.storage),React.createElement(R,{style:{flex:1},contentContainerStyle:{paddingBottom:38}},React.createElement(f,{style:{paddingVertical:24,paddingHorizontal:12},spacing:24},React.createElement(y,{title:"Server whitelist"},React.createElement(E,{value:o.storage.guildWhitelist,onChange:function(e){return o.storage.guildWhitelist=e}}))))}const _=i.findByStoreName("ChannelStore"),v=i.findByStoreName("GuildStore"),A=i.findByStoreName("SelectedChannelStore"),{allSummaries:B}=i.findByProps("allSummaries"),{sendBotMessage:C}=i.findByProps("sendBotMessage"),w=(o.storage.guildWhitelist??"").split(","),c=[],l=[];function u(e){const t=A.getChannelId();c.includes(t)||(d.logger.log(`Adding selected channel ${t} to whitelist`),c.push(t)),e.forEach(function([n,M]){M.forEach(function(a){if(l.includes(a.id))return;l.push(a.id),d.logger.log("Found new summary: ",a);const r=_.getChannel(n);(w.includes(r.guild_id)||c.includes(r.id))&&I(r,a)})})}function I(e,t){const n=v.getGuild(e.guild_id);h.showToast(`${n.name} > #${e.name}: ${t.topic}`),C(e.id,[`## ${t.topic}`,t.summShort,`### [Jump to beginning](https://discord.com/channels/${e.guild_id}/${e.id}/${t.startId})`,"","-# Automated message by Summaries plugin"].join(`
`))}const T=g.before("dispatch",m.FluxDispatcher,function([e]){if(e.type!=="CONVERSATION_SUMMARY_UPDATE")return;d.logger.log("Received CONVERSATION_SUMMARY_UPDATE dispatch: ",e);const t=e.summaries?.map?.(function(n){return{id:n.id,topic:n.topic,summShort:n.summ_short,startId:n.start_id,endId:n.end_id}});t&&u([[e.channel_id,t]])});u(Object.entries(B()));const N=T,b=$;return s.settings=b,s.unpatch=N,s})({},vendetta,vendetta.patcher,vendetta.metro,vendetta.metro.common,vendetta.plugin,vendetta.ui.toasts,vendetta.storage,vendetta.ui.components);
