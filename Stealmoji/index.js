(function(B,i,p,E,a,S,g,L,P){"use strict";const D=a.findByProps("convertSurrogateToName"),s=a.findByProps("hideActionSheet"),k=a.findByProps("openMediaModal"),F=a.findByProps("uploadEmoji"),_=a.findByProps("ActionSheet")?.ActionSheet??a.find(function(e){return e.render?.name==="ActionSheet"}),{ActionSheetTitleHeader:z,ActionSheetCloseButton:G}=a.findByProps("ActionSheetTitleHeader"),{BottomSheetFlatList:U}=a.findByProps("BottomSheetScrollView"),O=a.findByStoreName("EmojiStore"),V=a.findByStoreName("GuildStore"),H=a.findByStoreName("PermissionStore"),{default:K,GuildIconSizes:X}=a.findByProps("GuildIconSizes"),{downloadMediaAsset:q}=a.findByProps("downloadMediaAsset");function J(e){return new Promise(function(t,n){i.ReactNative.Image.getSize(e,function(o,r){t([o,r])},n)})}async function Q(e){const[t,n]=await J(e),{width:o,height:r}=i.ReactNative.Dimensions.get("window");s.hideActionSheet(),k.openMediaModal({initialSources:[{uri:e,sourceURI:e,width:t,height:n}],initialIndex:0,originLayout:{width:128,height:128,x:o/2-64,y:r-64,resizeMode:"fill"}})}function I(e,t){fetch(e).then(function(n){n.blob().then(function(o){const r=new FileReader;r.readAsDataURL(o),r.onloadend=function(){t(r.result)}})})}const{openAlert:W}=a.findByProps("openAlert","dismissAlert"),{AlertModal:N,AlertActionButton:w}=a.findByProps("AlertModal","AlertActions"),{Stack:Y,TextInput:Z}=a.findByProps("Stack");function ee(e){N&&w?te(e):L.showInputAlert(e)}function te(e){const t=j(e.title);W(j(e.title),React.createElement(ne,{key:t,title:e.title,content:e.content,initialValue:e.initialValue,placeholder:e.placeholder,onConfirm:e.onConfirm,confirmText:e.confirmText,cancelText:e.cancelText,allowEmpty:e.allowEmpty}))}function ne({key:e,title:t,content:n,initialValue:o,placeholder:r,onConfirm:c,confirmText:l,cancelText:d,allowEmpty:R}){const[u,A]=React.useState(o??"");function h(){if(!R&&!u.trim().length)return g.showToast("Cannot add with a blank name");c(u)}return React.createElement(N,{title:t,content:n,extraContent:React.createElement(Z,{isClearable:!0,value:u,onChange:A,placeholder:r,returnKeyType:"done",onSubmitEditing:h}),actions:React.createElement(Y,null,React.createElement(w,{disabled:!u.trim().length,text:l,variant:"primary",onPress:h}),d?React.createElement(w,{text:d,variant:"secondary"}):React.createElement(React.Fragment,null))})}function j(e){return`vdarnfg-${e?.toLowerCase?.().replaceAll?.(" ","-")}`}const oe=a.findByProps("getMaxEmojiSlots"),{FormRow:ie,FormIcon:ae}=E.Forms;function re({guild:e,emojiNode:t}){const n=function(){ee({title:"Emoji name",initialValue:t.alt,placeholder:"bleh",onConfirm:async function(c){I(t.src,function(l){F.uploadEmoji({guildId:e.id,image:l,name:c,roles:void 0}).then(function(){g.showToast(`Added ${t.alt} ${t.alt!==c?`as ${c} `:""}to ${e.name}`,S.getAssetIDByName("Check"))}).catch(function(d){g.showToast(d.body.message,S.getAssetIDByName("Small"))})})},confirmText:`Add to ${e.name}`,confirmColor:void 0,cancelText:"Cancel"}),s.hideActionSheet()};let o=!1;const r=i.React.useMemo(function(){let c=e.getMaxEmojiSlots?.()??oe?.getMaxEmojiSlots?.(e);c||(o||(o=!0,g.showToast("Failed to check max emoji slots")),c=250);const l=O.getGuilds()[e.id]?.emojis??[],d=t.src.includes(".gif");return l.filter(function(R){return R?.animated===d}).length<c},[]);return i.React.createElement(ie,{leading:i.React.createElement(K,{guild:e,size:X.MEDIUM,animate:!1}),disabled:!r,label:e.name,subLabel:r?o?"Failed to check max emoji slots":void 0:"No slots available",trailing:i.React.createElement(ae,{style:{opacity:1},source:S.getAssetIDByName("ic_add_24px")}),onPress:n})}const{FormDivider:ce,FormIcon:le}=E.Forms;function se(e){const t=React.createElement(_,{scrollable:!0},React.createElement(E.ErrorBoundary,null,React.createElement(ue,{emojiNode:e})));s.openLazy(Promise.resolve({default:function(){return t}}),"AddToServerActionSheet")}function ue({emojiNode:e}){const t=Object.values(V.getGuilds()).filter(function(n){return H.can(i.constants.Permissions.MANAGE_GUILD_EXPRESSIONS,n)}).sort(function(n,o){return n.name?.localeCompare?.(o.name)});return React.createElement(React.Fragment,null,React.createElement(z,{title:`Stealing ${e.alt}`,leading:React.createElement(le,{style:{marginRight:12,opacity:1},source:{uri:e.src},disableColor:!0}),trailing:React.createElement(G,{onPress:function(){return s.hideActionSheet()}})}),React.createElement(U,{style:{flex:1},contentContainerStyle:{paddingBottom:24},data:t,renderItem:function({item:n}){return React.createElement(re,{guild:n,emojiNode:e})},ItemSeparatorComponent:ce,keyExtractor:function(n){return n.id}}))}const{Button:x}=a.findByProps("TableRow","Button");function C({emojiNode:e}){const t=[{text:"Add to Server",callback:function(){return se(e)}},{text:"Copy URL to clipboard",callback:function(){i.clipboard.setString(e.src),s.hideActionSheet(),g.showToast(`Copied ${e.alt}'s URL to clipboard`,S.getAssetIDByName("ic_copy_message_link"))}},...i.ReactNative.Platform.select({ios:[{text:"Copy image to clipboard",callback:function(){return I(e.src,function(n){i.clipboard.setImage(n.split(",")[1]),s.hideActionSheet(),g.showToast(`Copied ${e.alt}'s image to clipboard`,S.getAssetIDByName("ic_message_copy"))})}}],default:[]}),{text:`Save image to ${i.ReactNative.Platform.select({android:"Downloads",default:"Camera Roll"})}`,callback:function(){q(e.src,e.src.includes(".gif")?1:0),s.hideActionSheet(),g.showToast(`Saved ${e.alt}'s image to ${i.ReactNative.Platform.select({android:"Downloads",default:"Camera Roll"})}`,S.getAssetIDByName("toast_image_saved"))}}];return React.createElement(React.Fragment,null,t.map(function({text:n,callback:o}){return React.createElement(x,{color:x.Colors?.BRAND,text:n,size:x.Sizes?.SMALL,onPress:o,style:{marginTop:i.ReactNative.Platform.select({android:12,default:16})}})}))}const{TouchableOpacity:de}=E.General,M=a.findByProps("GuildDetails");function fe(){if(M)return $("default",M);const e=[],t=p.before("openLazy",s,function([n,o]){o==="MessageEmojiActionSheet"&&(t(),n.then(function(r){e.push(p.after("default",r,function(c,l){e.push($("type",l,!0))}))}))});return function(){return t(),e.forEach(function(n){return n?.()})}}function $(e,t,n=!1){const o=p.after(e,t,function([{emojiNode:r}],c){if(i.React.useEffect(function(){return function(){return void(n&&o())}},[]),!r.src)return;const l=c?.props?.children?.props?.children;if(!l)return;const d=p.after("type",l,function(R,u){i.React.useEffect(function(){return d},[]);const A=function(f){return f?.props?.source?.uri},h=P.findInReactTree(u,function(f){return f?.find?.(A)}),y=h?.findIndex?.(A)??-1;y>=0&&(h[y]=i.React.createElement(de,{onPress:function(){return Q(r.src.split("?")[0])}},h[y]));const b=function(f){return f?.type?.name==="Button"},v=P.findInReactTree(u,function(f){return f?.find?.(b)}),m=v?.findLastIndex?.(b)??-1;m>=0?v.splice(m+1,0,i.React.createElement(C,{emojiNode:r})):u?.props?.children?.push?.(i.React.createElement(C,{emojiNode:r}))})});return o}function pe(e){let t;return function(){return t??=e()}}const he=pe(function(){const{MessagesHandlers:e}=a.findByProps("MessagesHandlers"),t=new e(function(){});return t.isModalOrActionsheetObstructing=function(){return s.hideActionSheet()},function(n){return t.handleTapEmoji({nativeEvent:{node:n}})}});function me({id:e,name:t,animated:n}){try{he()(e?{id:e,alt:t,src:`https://cdn.discordapp.com/emojis/${e}.${n?"gif":"webp"}?size=128`}:{content:D.convertSurrogateToName(t),surrogate:t})}catch(o){console.log("Failed to open action sheet",o)}}const{TouchableOpacity:ge}=E.General;function ye(){return p.before("openLazy",s,function([e,t]){t=="MessageReactions"&&e.then(function(n){const o=p.after("default",n,function(r,c){i.React.useEffect(function(){return o},[]);const l=p.after("type",c?.props?.children,function(d,R){i.React.useEffect(function(){return l},[]);const u=p.after("type",R?.props?.header,function(A,h){i.React.useEffect(function(){return u},[]);const y=P.findInReactTree(h,function(m){return m?.props?.tabs?.length});if(!y)return;const{tabs:b,onSelect:v}=y.props;y.props.tabs=b.map(function(m){return i.React.createElement(ge,{onPress:function(){return v(m.props.index)},onLongPress:function(){const{emoji:f}=m.props.reaction;me(f)}},m)})})})})})})}let T=[];var Se={onLoad:function(){T.push(fe()),T.push(ye())},onUnload:function(){for(const e of T)e()}};return B.default=Se,Object.defineProperty(B,"__esModule",{value:!0}),B})({},vendetta.metro.common,vendetta.patcher,vendetta.ui.components,vendetta.metro,vendetta.ui.assets,vendetta.ui.toasts,vendetta.ui.alerts,vendetta.utils);
