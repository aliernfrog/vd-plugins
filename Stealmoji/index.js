(function(P,a,h,A,r,R,y,D,w){"use strict";const k=r.findByProps("convertSurrogateToName"),u=r.findByProps("hideActionSheet"),F=r.findByProps("openMediaModal"),_=r.findByProps("uploadEmoji"),z=r.findByProps("ActionSheet")?.ActionSheet??r.find(function(e){return e.render?.name==="ActionSheet"}),{ActionSheetTitleHeader:G,ActionSheetCloseButton:U}=r.findByProps("ActionSheetTitleHeader"),{BottomSheetFlatList:O}=r.findByProps("BottomSheetScrollView"),V=r.findByStoreName("EmojiStore"),H=r.findByStoreName("GuildStore"),K=r.findByStoreName("PermissionStore"),{default:X,GuildIconSizes:q}=r.findByProps("GuildIconSizes"),{downloadMediaAsset:J}=r.findByProps("downloadMediaAsset");function Q(e){return new Promise(function(t,n){a.ReactNative.Image.getSize(e,function(o,i){t([o,i])},n)})}async function W(e){const[t,n]=await Q(e),{width:o,height:i}=a.ReactNative.Dimensions.get("window");u.hideActionSheet(),F.openMediaModal({initialSources:[{uri:e,sourceURI:e,width:t,height:n}],initialIndex:0,originLayout:{width:128,height:128,x:o/2-64,y:i-64,resizeMode:"fill"}})}function N(e,t){fetch(e).then(function(n){n.blob().then(function(o){const i=new FileReader;i.readAsDataURL(o),i.onloadend=function(){t(i.result)}})})}const{openAlert:Y}=r.findByProps("openAlert","dismissAlert"),{AlertModal:j,AlertActionButton:x}=r.findByProps("AlertModal","AlertActions"),{Stack:Z,TextInput:ee}=r.findByProps("Stack");function te(e){j&&x?ne(e):D.showInputAlert(e)}function ne(e){const t=M(e.title);Y(M(e.title),React.createElement(oe,{key:t,title:e.title,content:e.content,initialValue:e.initialValue,placeholder:e.placeholder,onConfirm:e.onConfirm,confirmText:e.confirmText,cancelText:e.cancelText,allowEmpty:e.allowEmpty}))}function oe(e){let{key:t,title:n,content:o,initialValue:i,placeholder:s,onConfirm:c,confirmText:l,cancelText:f,allowEmpty:E}=e;const[d,v]=React.useState(i??"");function m(){if(!E&&!d.trim().length)return y.showToast("Cannot add with a blank name");c(d)}return React.createElement(j,{title:n,content:o,extraContent:React.createElement(ee,{isClearable:!0,value:d,onChange:v,placeholder:s,returnKeyType:"done",onSubmitEditing:m}),actions:React.createElement(Z,null,React.createElement(x,{disabled:!d.trim().length,text:l,variant:"primary",onPress:m}),f?React.createElement(x,{text:f,variant:"secondary"}):React.createElement(React.Fragment,null))})}function M(e){return`vdarnfg-${e?.toLowerCase?.().replaceAll?.(" ","-")}`}const ie=r.findByProps("getMaxEmojiSlots"),{FormRow:ae,FormIcon:re}=A.Forms;function ce(e){let{guild:t,emojiNode:n}=e;const o=function(){te({title:"Emoji name",initialValue:n.alt,placeholder:"bleh",onConfirm:async function(c){N(n.src,function(l){_.uploadEmoji({guildId:t.id,image:l,name:c,roles:void 0}).then(function(){y.showToast(`Added ${n.alt} ${n.alt!==c?`as ${c} `:""}to ${t.name}`,R.getAssetIDByName("Check"))}).catch(function(f){y.showToast(f.body.message,R.getAssetIDByName("Small"))})})},confirmText:`Add to ${t.name}`,confirmColor:void 0,cancelText:"Cancel"}),u.hideActionSheet()};let i=!1;const s=a.React.useMemo(function(){let c=t.getMaxEmojiSlots?.()??ie?.getMaxEmojiSlots?.(t);c||(i||(i=!0,y.showToast("Failed to check max emoji slots")),c=250);const l=V.getGuilds()[t.id]?.emojis??[],f=n.src.includes(".gif");return l.filter(function(E){return E?.animated===f}).length<c},[]);return a.React.createElement(ae,{leading:a.React.createElement(X,{guild:t,size:q.MEDIUM,animate:!1}),disabled:!s,label:t.name,subLabel:s?i?"Failed to check max emoji slots":void 0:"No slots available",trailing:a.React.createElement(re,{style:{opacity:1},source:R.getAssetIDByName("ic_add_24px")}),onPress:o})}const{FormDivider:le,FormIcon:se}=A.Forms;function ue(e){const t=React.createElement(z,{scrollable:!0},React.createElement(A.ErrorBoundary,null,React.createElement(de,{emojiNode:e})));u.openLazy(Promise.resolve({default:function(){return t}}),"AddToServerActionSheet")}function de(e){let{emojiNode:t}=e;const n=Object.values(H.getGuilds()).filter(function(o){return K.can(a.constants.Permissions.MANAGE_GUILD_EXPRESSIONS,o)}).sort(function(o,i){return o.name?.localeCompare?.(i.name)});return React.createElement(React.Fragment,null,React.createElement(G,{title:`Stealing ${t.alt}`,leading:React.createElement(se,{style:{marginRight:12,opacity:1},source:{uri:t.src},disableColor:!0}),trailing:React.createElement(U,{onPress:function(){return u.hideActionSheet()}})}),React.createElement(O,{style:{flex:1},contentContainerStyle:{paddingBottom:24},data:n,renderItem:function(o){let{item:i}=o;return React.createElement(ce,{guild:i,emojiNode:t})},ItemSeparatorComponent:le,keyExtractor:function(o){return o.id}}))}const{Button:T}=r.findByProps("TableRow","Button");function C(e){let{emojiNode:t}=e;const n=[{text:"Add to Server",callback:function(){return ue(t)}},{text:"Copy URL to clipboard",callback:function(){a.clipboard.setString(t.src),u.hideActionSheet(),y.showToast(`Copied ${t.alt}'s URL to clipboard`,R.getAssetIDByName("ic_copy_message_link"))}},...a.ReactNative.Platform.select({ios:[{text:"Copy image to clipboard",callback:function(){return N(t.src,function(o){a.clipboard.setImage(o.split(",")[1]),u.hideActionSheet(),y.showToast(`Copied ${t.alt}'s image to clipboard`,R.getAssetIDByName("ic_message_copy"))})}}],default:[]}),{text:`Save image to ${a.ReactNative.Platform.select({android:"Downloads",default:"Camera Roll"})}`,callback:function(){J(t.src,t.src.includes(".gif")?1:0),u.hideActionSheet(),y.showToast(`Saved ${t.alt}'s image to ${a.ReactNative.Platform.select({android:"Downloads",default:"Camera Roll"})}`,R.getAssetIDByName("toast_image_saved"))}}];return React.createElement(React.Fragment,null,n.map(function(o){let{text:i,callback:s}=o;return React.createElement(T,{color:T.Colors?.BRAND,text:i,size:T.Sizes?.SMALL,onPress:s,style:{marginTop:a.ReactNative.Platform.select({android:12,default:16})}})}))}const{TouchableOpacity:fe}=A.General,$=r.findByProps("GuildDetails");function pe(){if($)return L("default",$);const e=[],t=h.before("openLazy",u,function(n){let[o,i]=n;i==="MessageEmojiActionSheet"&&(t(),o.then(function(s){e.push(h.after("default",s,function(c,l){e.push(L("type",l,!0))}))}))});return function(){return t(),e.forEach(function(n){return n?.()})}}function L(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const o=h.after(e,t,function(i,s){let[{emojiNode:c}]=i;if(a.React.useEffect(function(){return function(){return void(n&&o())}},[]),!c.src)return;const l=s?.props?.children?.props?.children;if(!l)return;const f=h.after("type",l,function(E,d){a.React.useEffect(function(){return f},[]);const v=function(p){return p?.props?.source?.uri},m=w.findInReactTree(d,function(p){return p?.find?.(v)}),S=m?.findIndex?.(v)??-1;S>=0&&(m[S]=a.React.createElement(fe,{onPress:function(){return W(c.src.split("?")[0])}},m[S]));const b=function(p){return p?.type?.name==="Button"},B=w.findInReactTree(d,function(p){return p?.find?.(b)}),g=B?.findLastIndex?.(b)??-1;g>=0?B.splice(g+1,0,a.React.createElement(C,{emojiNode:c})):d?.props?.children?.push?.(a.React.createElement(C,{emojiNode:c}))})});return o}function he(e){let t;return function(){return t??=e()}}const me=he(function(){const{MessagesHandlers:e}=r.findByProps("MessagesHandlers"),t=new e(function(){});return t.isModalOrActionsheetObstructing=function(){return u.hideActionSheet()},function(n){return t.handleTapEmoji({nativeEvent:{node:n}})}});function ge(e){let{id:t,name:n,animated:o}=e;try{me()(t?{id:t,alt:n,src:`https://cdn.discordapp.com/emojis/${t}.${o?"gif":"webp"}?size=128`}:{content:k.convertSurrogateToName(n),surrogate:n})}catch(i){console.log("Failed to open action sheet",i)}}const{TouchableOpacity:ye}=A.General;function Se(){return h.before("openLazy",u,function(e){let[t,n]=e;n=="MessageReactions"&&t.then(function(o){const i=h.after("default",o,function(s,c){a.React.useEffect(function(){return i},[]);const l=h.after("type",c?.props?.children,function(f,E){a.React.useEffect(function(){return l},[]);const d=h.after("type",E?.props?.header,function(v,m){a.React.useEffect(function(){return d},[]);const S=w.findInReactTree(m,function(g){return g?.props?.tabs?.length});if(!S)return;const{tabs:b,onSelect:B}=S.props;S.props.tabs=b.map(function(g){return a.React.createElement(ye,{onPress:function(){return B(g.props.index)},onLongPress:function(){const{emoji:p}=g.props.reaction;ge(p)}},g)})})})})})})}let I=[];var Re={onLoad:function(){I.push(pe()),I.push(Se())},onUnload:function(){for(const e of I)e()}};return P.default=Re,Object.defineProperty(P,"__esModule",{value:!0}),P})({},vendetta.metro.common,vendetta.patcher,vendetta.ui.components,vendetta.metro,vendetta.ui.assets,vendetta.ui.toasts,vendetta.ui.alerts,vendetta.utils);
